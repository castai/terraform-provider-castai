---
page_title: "castai_node_configuration Resource - terraform-provider-castai"
subcategory: ""
description: |-
  Create node configuration for given cluster. Node configuration reference https://docs.cast.ai/docs/node-configuration
---

# castai_node_configuration (Resource)

Create node configuration for given cluster. Node configuration [reference](https://docs.cast.ai/docs/node-configuration)

Manages cluster node configurations that will be applied to CAST AI provisioned nodes.
If you choose to add new node configuration that will be applied to all newly provisioned nodes, you will have to mark
it as the default using `castai_node_configuration_default` resource.

## Example Usage

```terraform
variable "init_script" {
  type    = string
  default = <<EOF
#!/bin/bash
echo "hello"
EOF
}

resource "castai_node_configuration" "default" {
  name           = "default"
  cluster_id     = castai_eks_cluster.test.id
  disk_cpu_ratio = 35
  min_disk_size  = 133
  subnets        = aws_subnet.test[*].id
  init_script    = base64encode(var.init_script)
  docker_config = jsonencode({
    "insecure-registries"      = ["registry.com:5000"],
    "max-concurrent-downloads" = 10
  })
  kubelet_config = jsonencode({
    "registryBurst" : 20,
    "registryPullQPS" : 10
  })
  container_runtime = "dockerd"
  tags = {
    env = "development"
  }
  eks {
    instance_profile_arn = aws_iam_instance_profile.test.arn
    dns_cluster_ip       = "10.100.0.10"
    security_groups      = [aws_security_group.test.id]
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `cluster_id` (String) CAST AI cluster id
- `name` (String) Name of the node configuration. It must be unique within the cluster. In case of cluster is reonboarded to Terraform, when previously it was onboarded with CAST AI UI, and the name corresponds to previously created node configuration this resource will override existing configuration instead of creating new.
- `subnets` (List of String) Subnet ids to be used for provisioned nodes

### Optional

- `aks` (Block List, Max: 1) (see [below for nested schema](#nestedblock--aks))
- `container_runtime` (String) Optional container runtime to be used by kubelet. Applicable for EKS only.  Supported values include: `dockerd`, `containerd`
- `disk_cpu_ratio` (Number) Disk to CPU ratio. Sets the number of GiBs to be added for every CPU on the node. Defaults to 0
- `docker_config` (String) Optional docker daemon configuration properties in JSON format. Provide only properties that you want to override. Applicable for EKS only. [Available values](https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file)
- `drain_timeout_sec` (Number) Timeout in seconds for draining the node. Defaults to 0
- `eks` (Block List, Max: 1) (see [below for nested schema](#nestedblock--eks))
- `gke` (Block List, Max: 1) (see [below for nested schema](#nestedblock--gke))
- `image` (String) Image to be used while provisioning the node. If nothing is provided will be resolved to latest available image based on Image family, Kubernetes version and node architecture if possible. See Cast.ai documentation for details.
- `init_script` (String) Init script to be run on your instance at launch. Should not contain any sensitive data. Value should be base64 encoded
- `kops` (Block List, Max: 1) (see [below for nested schema](#nestedblock--kops))
- `kubelet_config` (String) Optional kubelet configuration properties in JSON format. Provide only properties that you want to override. Applicable for EKS only. [Available values](https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/)
- `min_disk_size` (Number) Minimal disk size in GiB. Defaults to 100, min 30, max 65536
- `ssh_public_key` (String) SSH public key to be used for provisioned nodes
- `tags` (Map of String) Tags to be added on cloud instances for provisioned nodes
- `timeouts` (Block, Optional) (see [below for nested schema](#nestedblock--timeouts))

### Read-Only

- `id` (String) The ID of this resource.

<a id="nestedblock--aks"></a>
### Nested Schema for `aks`

Optional:

- `max_pods_per_node` (Number) Maximum number of pods that can be run on a node, which affects how many IP addresses you will need for each node. Defaults to 30
- `os_disk_type` (String) Type of managed os disk attached to the node. (See [disk types](https://learn.microsoft.com/en-us/azure/virtual-machines/disks-types)). One of: standard, standard-ssd, premium-ssd (ultra and premium-ssd-v2 are not supported for os disk)


<a id="nestedblock--eks"></a>
### Nested Schema for `eks`

Required:

- `instance_profile_arn` (String) Cluster's instance profile ARN used for CAST provisioned nodes
- `security_groups` (List of String) Cluster's security groups configuration for CAST provisioned nodes

Optional:

- `dns_cluster_ip` (String) IP address to use for DNS queries within the cluster
- `eks_image_family` (String) Image OS Family to use when provisioning node in EKS. If both image and family are provided, the system will use provided image and provisioning logic for given family. If only image family is provided, the system will attempt to resolve the latest image from that family based on kubernetes version and node architecture. If image family is omitted, a default family (based on cloud provider) will be used. See Cast.ai documentation for details. Possible values: (al2,al2023,bottlerocket)
- `imds_hop_limit` (Number) Allow configure the IMDSv2 hop limit, the default is 2
- `imds_v1` (Boolean) When the value is true both IMDSv1 and IMDSv2 are enabled. Setting the value to false disables permanently IMDSv1 and might affect legacy workloads running on the node created with this configuration. The default is true if the flag isn't provided
- `ips_per_prefix` (Number) Number of IPs per prefix to be used for calculating max pods.
- `key_pair_id` (String) AWS key pair ID to be used for CAST provisioned nodes. Has priority over ssh_public_key
- `max_pods_per_node_formula` (String) Formula to calculate the maximum number of pods that can be run on a node. The following list of variables will be bound to a number before evaluating and can be used in the formula: NUM_MAX_NET_INTERFACES, NUM_IP_PER_INTERFACE, NUM_IP_PER_PREFIX, NUM_CPU, NUM_RAM_GB .
- `target_group` (Block List) AWS target groups configuration for CAST provisioned nodes (see [below for nested schema](#nestedblock--eks--target_group))
- `volume_iops` (Number) AWS EBS volume IOPS to be used for CAST provisioned nodes
- `volume_kms_key_arn` (String) AWS KMS key ARN for encrypting EBS volume attached to the node
- `volume_throughput` (Number) AWS EBS volume throughput in MiB/s to be used for CAST provisioned nodes
- `volume_type` (String) AWS EBS volume type to be used for CAST provisioned nodes. One of: gp3, gp2, io1, io2

<a id="nestedblock--eks--target_group"></a>
### Nested Schema for `eks.target_group`

Required:

- `arn` (String) AWS target group ARN for CAST provisioned nodes

Optional:

- `port` (Number) Port for AWS target group for CAST provisioned nodes



<a id="nestedblock--gke"></a>
### Nested Schema for `gke`

Optional:

- `disk_type` (String) Type of boot disk attached to the node. (See [disk types](https://cloud.google.com/compute/docs/disks#pdspecs)). One of: pd-standard, pd-balanced, pd-ssd, pd-extreme
- `max_pods_per_node` (Number) Maximum number of pods that can be run on a node, which affects how many IP addresses you will need for each node. Defaults to 110
- `network_tags` (List of String) Network tags to be added on a VM. (See [network tags](https://cloud.google.com/vpc/docs/add-remove-network-tags))
- `use_ephemeral_storage_local_ssd` (Boolean) Use ephemeral storage local SSD. Defaults to false
- `zones` (List of String, Deprecated) List of preferred availability zones to choose from when provisioning new nodes.


<a id="nestedblock--kops"></a>
### Nested Schema for `kops`

Optional:

- `key_pair_id` (String) AWS key pair ID to be used for provisioned nodes. Has priority over sshPublicKey


<a id="nestedblock--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String)
- `delete` (String)
- `read` (String)
- `update` (String)


## Importing
You can use the `terraform import` command to import existing node configuration to Terraform state.

To import a resource, first write a resource block for it in your configuration, establishing the name by which
it will be known to Terraform:
```hcl
resource "castai_node_configuration" "default" {
  # ...
}
```

Now terraform import can be run to attach an existing node configuration to this resource:
```shell
$ terraform import castai_node_configuration.default <cluster_id>/default
```

If you are using CAST AI Terraform modules, import command will be slightly different:
```shell
$ terraform import 'module.castai-eks-cluster.castai_node_configuration.this["default"]' <cluster_id>/default
```